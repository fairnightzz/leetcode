This one I did in linear time with a version of union find.
Better way might be to do the approach using a Hashset and only building when there is nothing before it.